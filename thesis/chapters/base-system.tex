\chapter{Base System}
This chapter describes the basic software system we are using on the Imote2
platform. Ranging from the bootloader through the Linux kernel up to the
userland software stack. Our DTN implementation, IBR-DTN, is excluded here as we
describe them in detail in a separate chapter.

\section{Bootstraping}
The Imote2 comes with TinyOS pre-installed. No bootloader or similar mechanism
is installed to allow reflashing of the device. As a last resort there is JTAG
available on the interface board and we used it together with OpenOCD and an
JTAGKeyTiny to bootstrap our linux system. Blob was used as bootloader to load
the kernel image from flash and give the right parameter to boot into the
userland root file system. Detailed steps can be found in the annex.

\section{Linux Kernel}
A recent Linux kernel (2.6.33) is used on the device. The basic support for the
PXA271 and the Imote2 board was already available in this kernel. More work was
needed to go into the driver for the radio transceiver.

\section{CC2420 Driver and ieee802154 stack}
Different driver have been available for the CC2420. An older TosMac driver and
a newer driver which used the ieee80154 networking stack from linux. We decided
to go with the later one to have something that could go into the mainline
kernel and therefor provide us with an easier long term use and maintenance.

Like the 802.15.4 protocol the Linux stack is divided into two layers. The
physical layer which is called ieee802154 and the mac layer which is called
mac80154. While the former is already merged into the mainline kernel the later
one is still being developed and lives inside the kernel repository of the
linux-zigbee project.

During initial research a cc2420 driver based on the new linux stack showed up
and was submitted right in time for our research. Some debugging and bug fixing
had to be applied to this driver before it was fully functional. It is now and
sits in the linux-zigbee tree to get merged with the may layer once they is
mature enough to hit the mainline linux kernel.

\section{OpenEmbedded base system}
On top of the Linux kernel we needed a small linux root file system which
contains all userland components that are in use to get data from the kernel
into IBR-DTN and back.

We have chosen OpenEmbedded as the build system here to buildsystem here to
provide us with a working kernel image and matching rootfs we could flash onto
the device. Some more informations about OpenEmbedded and our use on the Imote2
could be found in the annex.

